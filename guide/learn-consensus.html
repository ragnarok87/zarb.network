<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Consensus Engine | Zarb</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Zarb blockchain">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.c50c7d33.css" as="style"><link rel="preload" href="/assets/js/app.176d1ffb.js" as="script"><link rel="preload" href="/assets/js/2.d239b192.js" as="script"><link rel="preload" href="/assets/js/3.acc4150a.js" as="script"><link rel="prefetch" href="/assets/js/10.6d15e2c4.js"><link rel="prefetch" href="/assets/js/11.b9c19785.js"><link rel="prefetch" href="/assets/js/12.051aa140.js"><link rel="prefetch" href="/assets/js/13.58fe12e5.js"><link rel="prefetch" href="/assets/js/14.61835a3c.js"><link rel="prefetch" href="/assets/js/15.f481ccf2.js"><link rel="prefetch" href="/assets/js/16.5838a7b2.js"><link rel="prefetch" href="/assets/js/17.44df8706.js"><link rel="prefetch" href="/assets/js/18.fe50f631.js"><link rel="prefetch" href="/assets/js/19.5ed1c846.js"><link rel="prefetch" href="/assets/js/20.06880085.js"><link rel="prefetch" href="/assets/js/21.3146947c.js"><link rel="prefetch" href="/assets/js/22.cf24a9a2.js"><link rel="prefetch" href="/assets/js/23.1ee48184.js"><link rel="prefetch" href="/assets/js/24.1967532f.js"><link rel="prefetch" href="/assets/js/25.a092e1da.js"><link rel="prefetch" href="/assets/js/26.1b4954e3.js"><link rel="prefetch" href="/assets/js/4.d6798b74.js"><link rel="prefetch" href="/assets/js/5.7b39f82b.js"><link rel="prefetch" href="/assets/js/6.61e5fdd8.js"><link rel="prefetch" href="/assets/js/7.d1f1ef35.js"><link rel="prefetch" href="/assets/js/8.be8af0ba.js"><link rel="prefetch" href="/assets/js/9.5f5f3416.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c50c7d33.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Zarb</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/run-index.html" class="nav-link">
  Run a node
</a></div><div class="nav-item"><a href="/guide/learn-index.html" class="nav-link">
  Learn
</a></div><div class="nav-item"><a href="https://github.com/zarbchain/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/run-index.html" class="nav-link">
  Run a node
</a></div><div class="nav-item"><a href="/guide/learn-index.html" class="nav-link">
  Learn
</a></div><div class="nav-item"><a href="https://github.com/zarbchain/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/guide/" aria-current="page" class="sidebar-link">Getting Started</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Run</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/run-index.html" class="sidebar-link">How to run</a></li><li><a href="/guide/run-compile.html" class="sidebar-link">Compile Zarb</a></li><li><a href="/guide/run-docker.html" class="sidebar-link">Using Docker</a></li><li><a href="/guide/run-ansible.html" class="sidebar-link">Using Ansible</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Learn</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/learn-index.html" class="sidebar-link">How Zarb Works?</a></li><li><a href="/guide/learn-cryptography.html" class="sidebar-link">Cryptography</a></li><li><a href="/guide/learn-serialization.html" class="sidebar-link">Data serialization</a></li><li><a href="/guide/learn-consensus.html" aria-current="page" class="active sidebar-link">Consensus Engine</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/learn-consensus.html#practical-byzantine-fault-tolerant" class="sidebar-link">Practical Byzantine Fault Tolerant</a></li><li class="sidebar-sub-header"><a href="/guide/learn-consensus.html#zarb-consensus-engine" class="sidebar-link">Zarb Consensus Engine</a></li><li class="sidebar-sub-header"><a href="/guide/learn-consensus.html#a-paradox" class="sidebar-link">A paradox</a></li><li class="sidebar-sub-header"><a href="/guide/learn-consensus.html#delegated-proof-of-stake" class="sidebar-link">Delegated Proof of Stake</a></li><li class="sidebar-sub-header"><a href="/guide/learn-consensus.html#zarb-has-no-delegation" class="sidebar-link">Zarb has no delegation</a></li><li class="sidebar-sub-header"><a href="/guide/learn-consensus.html#how-vrf-works" class="sidebar-link">How VRF works?</a></li><li class="sidebar-sub-header"><a href="/guide/learn-consensus.html#references" class="sidebar-link">References</a></li></ul></li><li><a href="/guide/learn-params.html" class="sidebar-link">Chain params</a></li><li><a href="/guide/learn-address.html" class="sidebar-link">Address conversion</a></li><li><a href="/guide/learn-account.html" class="sidebar-link">Account info</a></li><li><a href="/guide/learn-validator.html" class="sidebar-link">Validator-info</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>Transactions</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/transaction-stamping.html" class="sidebar-link">Stamping transactions</a></li><li><a href="/guide/transaction-format.html" class="sidebar-link">Transaction format in Zarb</a></li><li><a href="/guide/transaction-send.html" class="sidebar-link">Send transaction</a></li><li><a href="/guide/transaction-bond.html" class="sidebar-link">Bond transaction</a></li><li><a href="/guide/transaction-sortition.html" class="sidebar-link">Sortition transaction</a></li></ul></section></li><li><a href="/guide/learn-block.html" class="sidebar-link">Block details</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="consensus-engine"><a href="#consensus-engine" class="header-anchor">#</a> Consensus Engine</h1> <h2 id="practical-byzantine-fault-tolerant"><a href="#practical-byzantine-fault-tolerant" class="header-anchor">#</a> Practical Byzantine Fault Tolerant</h2> <p>Zarb is based on Proof-of-Stake and uses Practical Byzantine Fault Tolerant (PBFT) for its consensus engine. There are other protocols for consensus engine like Paxos and Raft. However Paxos and Raft protocols aren’t Byzantine fault tolerant. The original paper is published on 1999. &quot;This paper presents a new, practical algorithm for state machine replication that tolerates Byzantine faults.&quot;</p> <p>In PBFT</p> <ol><li>A client sends a request to invoke a service operation to the primary (P)</li> <li>The primary multicasts the request to the backups</li> <li>Replicas execute the request and send a reply to the client</li> <li>The client waits for 3f+1 replies from different replicas with the same result; this is the result of the operation.</li></ol> <p>3f+1 means if there are f nodes that has a byzantine failure, there has to be more than 3f+1 nodes in order for the system to be byzantine fault tolerant.</p> <p>When the primary receives a client request it starts a three-phase protocol to atomically multicast the request to the replicas. The three phases are pre-prepare, prepare, and commit.</p> <p>The algorithm provides both safety and liveness assuming no more than 3f+1 replicas are faulty.</p> <p>Picture below shows the operation of the algorithm in the normal case of no primary faults. Replica 0 is the primary, replica 3 is faulty, and C is the client.</p> <p><img src="/assets/img/pbft.aef1804b.png" alt="Normal execution of the Practical Byzantine Fault Tolerance (PBFT) protocol"></p> <h2 id="zarb-consensus-engine"><a href="#zarb-consensus-engine" class="header-anchor">#</a> Zarb Consensus Engine</h2> <p>Zarb consensus engine inspired by PBFT. In each height a proposer start broadcasting a proposal block to validators. Validators  validate, execute and vote for the incoming block. If more than 2/3 of validators vote for a block, the block will be committed otherwise validators move to the next round or view.</p> <p>The three phases in Zarb consensus are Prepare and precommit and commit
<img src="/assets/img/zarb-consensus.d600071e.png" alt="Zarb consensus mechanism"></p> <h2 id="a-paradox"><a href="#a-paradox" class="header-anchor">#</a> A paradox</h2> <p>Unlike Proof of Work, which is based on competition between miners, Proof of Stake is based on cooperation between validators. Validators work together to validate a block, like a team. A good player will be incentivized and a bad actor will be punished and fired from the team. However, the question is how big this team or validator set can be?</p> <p>If your validator set gets big and bigger, the voting time will be loner and longer and also the set will be more vulnerable in network partition attack. For example, some calculation shows that with more than 100 validators, PoS blockchain becomes less efficient.</p> <p>In the other hand a blockchain will be more secure and decentralized if more validators participated on it. We have to secure blockchain with more validators but technically we can't achieve it. Here is a paradox!</p> <p>The block size can be another issue when the number of validators increase. Validators must put their signature information in each block as proof of the commit. As long as more than 2/3 of validators sign a block, the block will be committed into the blockchain. Increasing the size of validator set will increase the size of block and blockchain.</p> <h2 id="delegated-proof-of-stake"><a href="#delegated-proof-of-stake" class="header-anchor">#</a> Delegated Proof of Stake</h2> <p>Some blockchain solves this paradox by defining delegation, Delegated Proof of Stake (dPoS), people put their stakes in hand of a group of ‘delegates’ and these delegates validate transactions and produce blocks.</p> <p>But how can voters trust a delegate? If a delegate is acting badly, what will happen? You can stake your token in favor of good actors. But you still need a minimum trust on this platform. We know in the blockchain, the main concept is not trusting anyone. This is another paradox in dPoS.</p> <p>For example in the EOS blockchain, there is <a href="https://github.com/EOSIO/eos/blob/5068823fbc8a8f7d29733309c0496438c339f7dc/constitution.md" target="_blank" rel="noopener noreferrer">constitution<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for the people participating in the blockchain. This constitution is full of “shall” and “shall not”. In the long run, this blockchain will be ruled by a powerful organization and won’t be decentralized anymore.</p> <p><img src="/assets/img/delegated_proof_of_stake.228eb4b9.jpg" alt="Delegated Proof of Stake"></p> <h2 id="zarb-has-no-delegation"><a href="#zarb-has-no-delegation" class="header-anchor">#</a> Zarb has no delegation</h2> <p>The solution we are offering in Zarb is creating a <strong>dynamic set</strong> of validators. Validators can be changed randomly. Anyone can easily become a validator by staking some tokens. In each height, every validator starts running a Verifiable Random Function (VRF) in order to self-choose themselves. The VRF is absolutely random and the result can be verified cryptographically. Based on their stake and their chance, a validator can be in the set for the next run. Once a validator enters the set, the oldest validator in the set exits. So we can always guarantee that validators are in the set for a certain amount of time. In the set, validators have equal power and it helps to make a fully democratic set for the blockchain.</p> <p><img src="/assets/img/zarb_validator_pool.af9f5349.jpg" alt="Zarb Proof of Stake"></p> <h2 id="how-vrf-works"><a href="#how-vrf-works" class="header-anchor">#</a> How VRF works?</h2> <p>In each height validators outside the set run a VRF function which the seed is the previous block hash. The result is deterministic and Zero Knowledge provable. A validator based on its stake and its luck can enter the set for the next height. The formula is quite simple:</p> <p><img src="https://render.githubusercontent.com/render/math?math=R\=V\times S_{t}"><br> <em>which</em><br> <img src="https://render.githubusercontent.com/render/math?math=V">: VRF output between 0~1<br> <img src="https://render.githubusercontent.com/render/math?math=S_{t}">: Total stake<br></p> <p>If the result is less than the validator stake, then this validator is eligible to enter to the set for the next height. The validator needs to send a Sortition transaction with the proof of VRF. This transaction is valid for 21 blocks. When a validator enters the set the latest validator should leave the set to make it balance.</p> <h2 id="references"><a href="#references" class="header-anchor">#</a> References</h2> <ul><li><a href="http://pmg.csail.mit.edu/papers/osdi99.pdf" target="_blank" rel="noopener noreferrer">PracticalByzantineFaultTolerance<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://tendermint.com/static/docs/tendermint.pdf" target="_blank" rel="noopener noreferrer">Tendermint:  Consensus without Mining<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zarbchain/zarb.network/edit/main/docs/guide/learn-consensus.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/5/2021, 5:46:23 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/guide/learn-serialization.html" class="prev">
        Data serialization
      </a></span> <span class="next"><a href="/guide/learn-params.html">
        Chain params
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.176d1ffb.js" defer></script><script src="/assets/js/2.d239b192.js" defer></script><script src="/assets/js/3.acc4150a.js" defer></script>
  </body>
</html>
